
def pbDisplayGoldWindow(msgwindow)
  moneyString=$game_variables[291] ? $game_variables[291].to_s_formatted : "0"
  goldwindow=Window_AdvancedTextPokemon.new(_INTL("Power:\n<ar>{1}</ar>",moneyString))
  goldwindow.setSkin("Graphics/Windowskins/goldskin")
  goldwindow.resizeToFit(goldwindow.text,Graphics.width)
  goldwindow.width=160 if goldwindow.width<=160
  if msgwindow.y==0
    goldwindow.y=Graphics.height-goldwindow.height
  else
    goldwindow.y=0
  end
  goldwindow.viewport=msgwindow.viewport
  goldwindow.z=msgwindow.z
  return goldwindow
end

def pbDisplayPowerWindow(msgwindow)
  powerString=$game_variables[291] ? $game_variables[291].to_s_formatted : "0"
  powerwindow=Window_AdvancedTextPokemon.new(_INTL("Power:\n<ar>{1}</ar>",powerString))
  powerwindow.setSkin("Graphics/Windowskins/goldskin")
  powerwindow.resizeToFit(powerwindow.text,Graphics.width)
  powerwindow.width=160 if powerwindow.width<=160
  if msgwindow.y==0
    powerwindow.y=Graphics.height-goldwindow.height
  else
    powerwindow.y=0
  end
  powerwindow.viewport=msgwindow.viewport
  powerwindow.z=msgwindow.z
  return powerwindow
end



  powerwindow=nil

  textchunks=[]
  controls=[]
  while text[/(?:\\(f|ff|ts|cl|me|se|wt|wtnp|ch)\[([^\]]*)\]|\\(g|el|cn|pt|wd|wm|op|cl|wu|\.|\||\!|\^))/i]


      when "g"      # Display gold window
        powerwindow.dispose if powerwindow
        powerwindow = pbDisplayPowerWindow(msgwindow)
      when "el"      # Display gold window